<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace='system.team2.prod_mng'>
	<select id="getList" parameterType="cmmnMap" resultType="cmmnMap">
	SELECT  
		ep.prod_no,
		ep.prod_nm,
		ec_type.comm_nm AS prod_type,
		ec_target.comm_nm AS sub_tg,
		ep.pay_period,
		ec_cycle.comm_nm AS pay_cycle,
		ep.price_max,
		ep.price_min,
		ec_stat.comm_nm AS sale_stat,
		ep.sale_beg_dt,
		ep.sale_end_dt,
		ep.promtn_yn,
		ep.interest_no
	 FROM 
   		 kcgbd.e_product_save ep
			LEFT JOIN 
			    kcgbd.e_common ec_type ON ep.prod_type = ec_type.comm_no AND ec_type.group_comm_no = 4
			LEFT JOIN 
			    kcgbd.e_common ec_target ON ep.sub_tg = ec_target.comm_no AND ec_target.group_comm_no = 6
			LEFT JOIN 
			    kcgbd.e_common ec_cycle ON ep.pay_cycle = ec_cycle.comm_no AND ec_cycle.group_comm_no = 5
			LEFT JOIN 
			    kcgbd.e_common ec_stat ON ep.sale_stat = ec_stat.comm_no AND ec_stat.group_comm_no = 8
				where ep.promtn_yn='N'
		<if test='prod_nm != null and prod_nm != ""'>
		   and ep.prod_nm like CONCAT('%',#{prod_nm},'%')
		</if>
		<if test='prod_type != null and prod_type != ""'>
		   and ep.prod_type = #{prod_type}
		</if>
		<if test='sub_tg != null and sub_tg != ""'>
		   and ep.sub_tg = #{sub_tg}
		</if>
        <if test='from_date != null and from_date != ""'>
   		 AND CAST(#{from_date} AS DATE) BETWEEN sale_beg_dt AND sale_end_dt
		</if>
		
		UNION ALL
		SELECT  
			el.loan_prod_no,
			el.loan_prod_nm,
			ec_type.comm_nm AS prod_type,
			ec_target.comm_nm AS sub_tg,
			el.pay_period,
			ec_cycle.comm_nm AS pay_cycle,
			el.price_max,
			el.price_min,
			ec_stat.comm_nm AS sale_stat,
			el.loan_sale_beg_dt,
			el.loan_sale_end_dt,
			el.promtn_yn,
			el.interest_no
		 FROM 
   			 kcgbd.e_product_loan el
		LEFT JOIN 
		    kcgbd.e_common ec_type ON el.prod_type = ec_type.comm_no AND ec_type.group_comm_no = 4
		LEFT JOIN 
		    kcgbd.e_common ec_target ON el.sub_tg = ec_target.comm_no AND ec_target.group_comm_no = 6
		LEFT JOIN 
		    kcgbd.e_common ec_cycle ON el.pay_cycle = ec_cycle.comm_no AND ec_cycle.group_comm_no = 5
		LEFT JOIN 
		    kcgbd.e_common ec_stat ON el.loan_sale_stat = ec_stat.comm_no AND ec_stat.group_comm_no = 8
		    
			where el.promtn_yn='N'
			
		<if test='prod_nm != null and prod_nm != ""'>
		   and el.prod_nm like CONCAT('%',#{prod_nm},'%')
		</if>
		<if test='prod_type != null and prod_type != ""'>
		   and el.prod_type = #{prod_type}
		</if>
		<if test='sub_tg != null and sub_tg != ""'>
		   and el.sub_tg = #{sub_tg}
		</if>
        <if test='from_date != null and from_date != ""'>
   		 AND CAST(#{from_date} AS DATE) BETWEEN sale_beg_dt AND sale_end_dt
		</if>
		
		UNION ALL
		SELECT  
			ea.prod_no,
			ea.prod_nm,
			ec_type.comm_nm AS prod_type,
			ec_target.comm_nm AS sub_tg,
			ea.pay_period,
			ec_cycle.comm_nm AS pay_cycle,
			ea.price_max,
			ea.price_min,
			ec_stat.comm_nm AS sale_stat,
			ea.sale_beg_dt,
			ea.sale_end_dt,
			ea.promtn_yn,
			ea.interest_no
		 FROM 
   			 kcgbd.e_product_ac ea
			LEFT JOIN 
			    kcgbd.e_common ec_type ON ea.prod_type = ec_type.comm_no AND ec_type.group_comm_no = 4
			LEFT JOIN 
			    kcgbd.e_common ec_target ON ea.sub_tg = ec_target.comm_no AND ec_target.group_comm_no = 6
			LEFT JOIN 
			    kcgbd.e_common ec_cycle ON ea.pay_cycle = ec_cycle.comm_no AND ec_cycle.group_comm_no = 5
			LEFT JOIN 
			    kcgbd.e_common ec_stat ON ea.sale_stat = ec_stat.comm_no AND ec_stat.group_comm_no = 8
			    
				where ea.promtn_yn='N'
				
		<if test='prod_nm != null and prod_nm != ""'>
		   and ea.prod_nm like CONCAT('%',#{prod_nm},'%')
		</if>
		<if test='prod_type != null and prod_type != ""'>
		   and ea.prod_type = #{prod_type}
		</if>
		<if test='sub_tg != null and sub_tg != ""'>
		   and ea.sub_tg = #{sub_tg}
		</if>
        <if test='from_date != null and from_date != ""'>
   		 AND CAST(#{from_date} AS DATE) BETWEEN sale_beg_dt AND sale_end_dt
		</if>
		
		UNION ALL
		SELECT  
			ed.prod_no,
			ed.prod_nm,
			ec_type.comm_nm AS prod_type,
			ec_target.comm_nm AS sub_tg,
			ed.pay_period,
			ec_cycle.comm_nm AS pay_cycle,
			ed.price_max,
			ed.price_min,
			ec_stat.comm_nm AS sale_stat,
			ed.sale_beg_dt,
			ed.sale_end_dt,
			ed.promtn_yn,
			ed.interest_no
		FROM 
   		 kcgbd.e_product_dp ed
			LEFT JOIN 
			    kcgbd.e_common ec_type ON ed.prod_type = ec_type.comm_no AND ec_type.group_comm_no = 4
			LEFT JOIN 
			    kcgbd.e_common ec_target ON ed.sub_tg = ec_target.comm_no AND ec_target.group_comm_no = 6
			LEFT JOIN 
			    kcgbd.e_common ec_cycle ON ed.pay_cycle = ec_cycle.comm_no AND ec_cycle.group_comm_no = 5
			LEFT JOIN 
			    kcgbd.e_common ec_stat ON ed.sale_stat = ec_stat.comm_no AND ec_stat.group_comm_no = 8
			    
				where ed.promtn_yn='N'
				
		<if test='prod_nm != null and prod_nm != ""'>
		   and ed.prod_nm like CONCAT('%',#{prod_nm},'%')
		</if>
		<if test='prod_type != null and prod_type != ""'>
		   and ed.prod_type = #{prod_type}
		</if>
		<if test='sub_tg != null and sub_tg != ""'>
		   and ed.sub_tg = #{sub_tg}
		</if>
        <if test='from_date != null and from_date != ""'>
   		 AND CAST(#{from_date} AS DATE) BETWEEN sale_beg_dt AND sale_end_dt
		</if>
	</select>

</mapper>